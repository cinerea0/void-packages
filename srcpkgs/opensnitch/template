# Template file for 'opensnitch'
pkgname=opensnitch
version=1.6.0
revision=1
build_style=gnu-makefile
hostmakedepends="git go pkg-config protobuf protobuf-go protoc-gen-go-grpc
 python3-grpcio-tools python3-pip python3-PyQt5-devel-tools
 python3-setuptools qt5-host-tools"
makedepends="libnetfilter_queue-devel libpcap-devel python3-inotify
 python3-unicode-slugify python3-Unidecode"
depends="python3-googleapis-common-protos python3-grpcio python3-inotify
 python3-notify2 python3-pyasn1 python3-PyQt5 python3-PyQt5-sql
 python3-qt-material python3-unicode-slugify python3-Unidecode qt5-plugin-sqlite
 qt5-wayland"
conf_files="/etc/opensnitchd/default-config.json
 /etc/opensnitchd/system-fw.json"
make_dirs="/etc/opensnitchd/rules/ 0755 root root
 /etc/opensnitchd/ 0755 root root"
short_desc="GNU/Linux port of the Little Snitch application firewall"
maintainer="cinerea0 <cinerea0@protonmail.com>"
license="GPL-3.0-only"
homepage="https://github.com/evilsocket/opensnitch"
distfiles="https://github.com/evilsocket/opensnitch/archive/refs/tags/v${version}.tar.gz"
checksum=d468599f84f6dfde1afc0cad79ef0d511b7f5d5aafc14acbbf730ab0ae317342
nopie_files="/usr/bin/opensnitchd"
nocross="Go's 'sys' package uses a -m64 compilation flag which breaks certain ARM builds"

do_install() {
	vbin daemon/opensnitchd
	vinstall daemon/default-config.json 0644 etc/opensnitchd
	vinstall daemon/system-fw.json 0644 etc/opensnitchd
	cd ui
	python3 setup.py install --prefix=/usr --root=${DESTDIR}
	vsv opensnitchd
}
