# Template file for 'k9s'
pkgname=k9s
version=0.32.7
revision=1
build_style=go
build_helper=qemu
go_import_path="github.com/derailed/k9s"
go_ldflags="-X ${go_import_path}/cmd.version=${version}"
short_desc="Terminal UI to interact with Kubernetes clusters"
maintainer="Orphaned <orphan@voidlinux.org>"
license="Apache-2.0"
homepage="https://k9scli.io/"
changelog="https://github.com/derailed/k9s/releases"
distfiles="https://github.com/derailed/k9s/archive/refs/tags/v${version}.tar.gz"
checksum=508f5d22616d0a741b72171d31df6e6baa45298b3614b7f9a171fe3f05e74365

# fix: collect2: fatal error: cannot find 'ld'
export LDFLAGS="-fuse-ld=bfd"

post_install() {
	if [ "$XBPS_TARGET_MACHINE" != aarch64-musl ]; then
		# qemu-aarch64-static segfaults
		# https://github.com/void-linux/void-packages/actions/runs/12099906876/job/33737959193?pr=53276
		for shell in bash fish zsh; do
			vtargetrun "${DESTDIR}/usr/bin/k9s" completion "${shell}" > "k9s.${shell}"
			vcompletion "k9s.${shell}" "${shell}"
		done
	fi
}
